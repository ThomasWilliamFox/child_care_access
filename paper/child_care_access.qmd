---
title: "Inequitable Access"
subtitle: "An Analysis of Licensed Child Care in Toronto's 25 Wards"
author: 
  - Thomas Fox
thanks: "Code and data are available at: https://github.com/ThomasWilliamFox/child_care_access.git."
date: today
date-format: long
abstract: "Child care is essential for the well being of families, communities, and the children able to attend these facilities. This paper examines the accessibility of licensed child care centres across Toronto's 25 wards. Findings indicate that there are more children per existing child care space in wards with lower household incomes, lower proportions of English speaking households, and higher proprotions of the population identifying as racialized. These findings suggest inequitable access to licensed child care spaces based on a variety of social factors, supporting initiatives aimed at increasing access to licensed child care in the city of Toronto."
format: pdf
number-sections: true
bibliography: references.bib
toc: True 
nocite: |
  @tellingstories
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(arrow)
library(here)
library(palmerpenguins)
library(ggmap)
library(maps)
library(knitr)
library(rstanarm)
```

```{r}
#| include: false
#| warning: false
#| message: false
#| echo: false

#### Load data ####

# read child care data

child_care_data = read_parquet(
  file = here("data/analysis_data/child_care_data.parquet"),
  show_col_types = FALSE
)

# read summarized child care data 

summarized_child_care_data = read_parquet(
  file = here("data/analysis_data/ward_child_care_data.parquet"),
  show_col_types = FALSE
)

# read census ward data 

ward_data = read_parquet(
  file = here("data/analysis_data/census_data.parquet"),
  show_col_types = FALSE
)

# read merged data 

merged_ward_childcare = read_parquet(
  file = here("data/analysis_data/merged_ward_data.parquet"),
  show_col_types = FALSE
)

merged_data <- read_parquet(here::here("data/analysis_data/merged_ward_data.parquet"))
merged_data <-

merged_data

# read names data

ward_names = read_parquet(
  file = here("data/analysis_data/ward_names.parquet"),
  show_col_types = FALSE
)
```

# Introduction

Equitable access to child care is essential to the social and economic health of a community such as the City of Toronto. Access to child care has been shown have a positive impact occupational and educational opportunities for parents, especially those in lower income brackets [@childcare]. These economic advantages for parents and families bring benefits to their physical and social well-being [@childcare]. Child care access also impacts the health and development of children attending these facilities [@rhijn]. Vulnerable children disproportionately benefit from child care access as these centers help to facilitate early intervention methods [@underwood]. Equitable access to child care is therefore a vital facet of community health and development.

This paper explores child care data from @caredata and ward data from @wards to explore child care access across the city of Toronto. These data sets are made freely available by Open Data Toronto [@opendatatoronto]. Data analysis and processing was performed using the programming language `R` [@citeR]. Various packages were used throughout the writing of this paper including `tidyverse` [@tidyverse], `arrow` [@arrow], `here` [@here], `ggmap` [@ggmap], `maps` [@maps], `knitr` [@knitr], `dplyr` [@dplyr], `janitor` [@janitor], and `rstanarm` [@rstanarm].    

This analysis explores relationships between child care demand and various demographic metrics across Toronto's 25 wards (see [@sec-results]). The paper's estimand is that average household income is negatively correlated with the number of children per child care space by ward. The paper also explores the relationships between existing child care spaces and the proportion of racialized and non-native-English speaking populations by ward. These findings demonstrate inequitable access to child care across the city of Toronto. As child care plays a central role in the social and economic well-being of communities, and has an especially positive impact on vulnerable children and low-income families, these findings support measures and initiatives aimed at ensuring more equitable access to child care in the city of Toronto [see @strategy].

The remainder of this paper is structured as follows. @sec-data outlines the data sets used throughout this paper made available by Open Data Toronto [@opendatatoronto]. @sec-childcare explores the "Licensed Child Care Centres" data set provided by @caredata, while @sec-warddata explores the "Ward Profiles (25-Ward Model)" data set provided by @wards. A model built to explore the impact of income on child care spaces in Toronto is outlined in @sec-model. Results of modeling and data analysis are found in @sec-results. This is followed by a discussion surrounding these findings and their implications in @sec-discussion. This section also includes discussions around potential weaknesses and next steps regarding this research.  

# Data {#sec-data}
## Licensed Child Care Centres {#sec-childcare}

The "Licensed Child Care Centres" data set is provided to Open Data Toronto [@opendatatoronto] by the City of Toronto's Children's Services division [@caredata]. The data set contains 1,066 entries, each corresponding to a licensed child care facility in Toronto. Variables chosen to isolate after cleaning include the facility ID number, the ward number where the facility is located, and the total number of individual child care spaces at the facility. Each facility's operation type is also isolated, with the data showing that there are 703 non profit, 324 commercial, and 39 public (City operated) facilities in Toronto. Information about whether the each facility has a fee subsidy contract or participates in the Canada-Wide Early Learning & Child Care (CWELCC) system is also included, with 68% of facilities having subsidy contracts and 87% of facilities participating in CWELCC. @tbl-childcaredata shows the first six entries in this data set and @fig-map shows the location of each facility across Toronto. 

```{r}
#| label: tbl-childcaredata
#| tbl-cap: Sample of Cleaned Toronto Licensed Child Care Centre Data
#| echo: false
#| warning: false

child_care_table <- 
  child_care_data |>
  select(x_id, ward, totspace, auspice, subsidy, cwelcc_flag)

head(child_care_table, 6) |>
  kable(
    col.names = c("Facility ID", " Ward Number", "Total Spaces", "Type", "Subsidy", "CWELCC"),
    booktabs = TRUE
  )

```

```{r out.width = '100%'}
#| label: fig-map
#| fig-cap: Map showing the loction of all licensed child care centres in Toronto
#| warning: false
#| message: false
#| echo: false

# Use google maps for box co-ordinates
bbox_toronto <- c(left =-79.669692514001, bottom = 43.57044, right = -79.096000099990, top = 43.85090373064596)

# Adds API key following instructions found here: https://tellingstorieswithdata.com/05-static_communication.html#maps
register_stadiamaps(key = "1662b375-446a-4847-acf3-831fb1381f2b", write = TRUE)

# Builds map using box co-ordinates
toronto_stamen_map <- get_stadiamap(bbox_toronto, zoom = 12, maptype = "stamen_toner_lite", crop = TRUE)
child_care_data
# Builds map with child care centres plotted
ggmap(toronto_stamen_map, extent = "panel", maprange = FALSE) +
  geom_point(data = child_care_data,
             aes(x = as.double(x), y = as.double(y)),
             alpha = 0.7, size = log(child_care_data$totspace)*.20, show.legend = FALSE) +
  labs(x = "Longitude", y = "Latitude") + 
  theme(axis.text.x = element_text(size = 8),
        axis.text.y = element_text(size = 8))
  
```

## Toronto Ward Profiles {#sec-warddata}

The "Ward Profiles (25-Ward Model)" data set is provided to Open Data Toronto (@opendatatoronto) by Toronto City Planning [@wards]. The data sets of interest in this paper found through this resource are the "2023-WardProfiles-2011-2021-CensusData" data set which is used to determine demographic information related to each ward, and the "25-WardNames-Numbers" data set that is used to code names to ward numbers in this paper [@wards]. Variables isolated from the 2021 Canada Census include ward number, population, number of children under 15, average yearly household income, number of households where English is spoken most often, population identifying as racialized. @tbl-warddata shows the first six entries in the cleaned data set.

```{r}
#| label: tbl-warddata
#| tbl-cap: Sample of Cleaned Toronto Ward Data
#| echo: false
#| warning: false

ward_data_table <- 
  merged_ward_childcare |>
  select(ward, total, total_under_15, avg_hh_income, english, visible_minority)

head(ward_data_table, 6) |>
  kable(
    col.names = c("Ward", "Total Population", "Children Under 15", "Average Household Income", "English Spoken Most Often in Household", "Population Identifying as Racialized"),
    booktabs = TRUE
  )

```

# Model {#sec-model}

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.

### Model justification

We expect a negative relationship between average household income and the number of children per child care space by ward. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.

# Results {#sec-results}

```{r}
#| label: fig-incomespaces
#| fig-cap: Relationship between income and child care spaces
#| warning: false
#| message: false
#| echo: false

merged_ward_childcare |>
  ggplot(aes(x = avg_hh_income, y = total_under_15/total_spots)) +
  geom_point(fill = "black", size = 1, shape = 23) +
  geom_smooth(method = lm, color = "black") +
  theme_minimal() +
  labs(x = "Average household income by ward", y = "Children per child care space") 
```

```{r}
#| label: fig-languagespaces
#| fig-cap: Relationship between language and child care spaces
#| warning: false
#| message: false
#| echo: false

merged_ward_childcare |>
  ggplot(aes(x = english/total*100, y = total_under_15/total_spots)) +
  geom_point(fill = "black", size = 1, shape = 23) +
  geom_smooth(method = lm, color = "black") +
  theme_minimal() +
  labs(x = "Proportion of English speaking households by ward (%)", y = "Children per child care space") 
```

```{r}
#| label: fig-nonminorityspaces
#| fig-cap: Relationship between non-racialized population by ward and child care spaces
#| warning: false
#| message: false
#| echo: false
merged_ward_childcare |>
  ggplot(aes(x = ((total-visible_minority)/total)*100, y = total_under_15/total_spots)) +
  geom_point(fill = "black", size = 1, shape = 23) +
  geom_smooth(method = lm, color = "black") +
  theme_minimal() +
  labs(x = "Porportion of ward population identified as non-racialized (%)", y = "Children per child care space") 
```  

Our results are summarized in @tbl-modelresults.

```{r}
#| include: false
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| include: true
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```


# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps


\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| include: true
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| include: true
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


